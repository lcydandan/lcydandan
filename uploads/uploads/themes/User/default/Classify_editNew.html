<include file="Public:head"/>
<TABLE>
<TR>
<TD width="450px" height="900px" margin-left="10px">
<div class="mask">
    <div class="phone">
    	<div class="phone_right"></div>
        <div class="close"></div>
        <iframe id="webpreview" class="preview" src="{ai9me::U('Wap/Index/index',array('token'=>$_GET['token'], 'weburl'=>$weburl))}" width="337" height="454" frameborder="0" scrolling="auto"></iframe>
	</div>
</div>
</TD>
<TD>
	<form class="form" method="post"   action="{ai9me::U('Classify/upsaveMany')}"  target="_top" enctype="multipart/form-data" >
	<span style="font-size:16px;font-weight:bold;margin-left:20px;">选择网页模板： </span>
	<select id="webmodel" name="webmodel" onchange="modelChange(this.value)">
		<option value="1" >模板1</option>
		<option value="2" >模板2</option>
		<option value="3" >模板3</option>
		<option value="4" >模板4</option>
		<option value="5" >模板5</option>
		<option value="6" >模板6</option>
		<option value="7" >模板7</option>
		<option value="8" >模板8</option>
		<option value="9" >模板9</option>
		<option value="10" >模板10</option>
		<option value="11" >模板11</option>
		<option value="12" >模板12</option>
		<option value="13" >模板13</option>
		<option value="14" >模板14</option>
		<option value="15" >模板15</option>		
	</select>
	<a style="color:red;" href="{ai9me::U('Tmpls/index',array('token'=>$token))}" target="_blank">点击查看所有模板</a>
 	<div class="mycontent" >
         <div class="cLineB">
         	<h4>添加3G网站素材</h4>
         	<a href="javascript:history.go(-1);"  class="right btnGrayS vm" style="margin-top:-27px" >返回</a>
         </div> 
         <div class="msgWrap">
  			
         	<TABLE id="classifyTable" class="userinfoArea" style=" margin:20px 0 0 0;" border="0" cellSpacing="0" cellPadding="0" width="100%" margin-top="5px">
			<THEAD>
			<TR>
			  <TH valign="top"><label for="keyword">网站标题：</label></TH>
			  <TD><input type="input" class="px" id="keyword" value="{ai9me:$info[0].webname}" name="webname" style="width:450px" ><br />
			                      该名称在手机上不显示，只用于标识不同3G网站
			                     </TD>
			  <TD>&nbsp;</TD>
			  <input type="hidden" name="weburl" value="{ai9me:$info[0].weburl}" >
			</TR>
			</THEAD>
			<TBODY>
				<TR>
				<TH valign="top">幻灯片选择:</TH>
				<TD>				
					<select name="flashinfo">
						<option value=""></option>
						<volist name="flash" id="vo">
							<option value="{ai9me:$vo.info}" <if condition="$vo['info'] eq $classifyflash['flashinfo']">selected</if>>{ai9me:$vo.info}</option>
						</volist>
					</select>
				</TD>
				</TR>
				<TR>
				<TH valign="top">网站背景图片:</TH>
				<TD>				
				<input class="bgimg" name="bgimg" value="{ai9me:$bgimg}" onchange="imgChange(this.value, this.name)" >
				<input type="button" class="bgimgupload"  onclick="window.open('{ai9me::U('Upload/index',array('token'=>$token,'n'=>bgimg, 'imgview'=>bgimgview))}')" value="点击上传图片">
				<br />有的模板不需要背景图片，可为空<img name="bgimgview" width="60px" height="60px" src="{ai9me:$bgimg}" <if condition="$bgimg eq ''">style="display:none;"</if>>
					
				</TD>
				</TR>
				<volist name="info" id="vo">
				  <TR>
				  <TH valign="top">图文编辑：</TH>
				  <TD>
				  <div style="border:1px solid #ccc;">
				  <TABLE class="imgtable">
				      <tr>  
					  <th valign="top">图片标题：</th>
					  <td>
					  	  <input class="input name" name="name{ai9me:$vo.sorts}" value="{ai9me:$vo.name}"><br />					  	  
					  </td>
					  </tr>
				      <tr>  
					  <th valign="top">图片描述：</th>
					  <td>
					  	  <input class="input info" name="info{ai9me:$vo.sorts}" value="{ai9me:$vo.info}"><br />
					  	  对图片的详细描述，建议30字以内，可为空
					  </td>
					  </tr>
					  <tr>
						  <th valign="top">图片上传：</th>
						  <td><input class="input img" name="img{ai9me:$vo.sorts}" value="{ai9me:$vo.img}" onchange="imgChange(this.value, this.name)"><br />
						  	建议图片大小：宽720高400  
						  	<input type="button" class="upload"  onclick="window.open('{ai9me::U('Upload/index',array('token'=>$token,'n'=>img.$vo['sorts'],'imgview'=>img.$vo['sorts'].view))}')" value="点击上传图片">
						  	<img class="imgview" width="60px" height="60px" name="img{ai9me:$vo.sorts}view" src="{ai9me:$vo.img}" <if condition="$vo['img'] eq ''">style="display:none;"</if>>
						  </td>						   	
					  </tr>
					  <tr>
						  <th valign="top">二次链接地址：</th>
						  <td><input class="input url" name="url{ai9me:$vo.sorts}" value="{ai9me:$vo.url}"><br />
						  	以http://开头
						  </td>
					  </tr>
					  <tr>
					  	<th></th>
					  	<td>
					  		<input type="button" value="删除" class="btndelete right" onclick="deleteImg(this)">
					  	</td>
					  </tr>
				  </TABLE>
				  </div>
				  </TD>
				  </TR>
				  </volist>
				  <TR>
					<TH></TH>
					<TD>
						<input type="button" id="addimage" value="增加图文描述" class="btnadd left" onclick="addImg(this)">
					</TD>
				  </TR>
				  <TR>
					  <TH></TH>
					  <TD><button type="submit"  name="button"  class="btnGreen left" >保存</button>
					  	<div class="clr"></div>
					  	</TD>
				  </TR>
			</TBODY>
			</TABLE>
         </div>
    </div>
</TD>
</TR>
</TABLE>        
        
        
        <div class="clr"></div>
      </div>
    </div>
  </div> 

<!--底部-->
  	</div>
  	
<script type="text/javascript">
	var xmlhttp;
	var nameIndex = document.getElementById("addimage").parentNode.parentNode.rowIndex - 2;
	var tplarray = ["tpl_101_index", "tpl_102_index","tpl_103_index","tpl_104_index","tpl_105_index",
	    			"tpl_106_index","tpl_107_index","tpl_108_index","tpl_109_index","tpl_110_index",
	    			"tpl_111_index","tpl_112_index","tpl_113_index","tpl_114_index","tpl_115_index"];
	    	var tplimages = ["{ai9me::RES}/images/cate101.png","{ai9me::RES}/images/cate102.png",
	    			"{ai9me::RES}/images/cate103.png","{ai9me::RES}/images/cate104.png",
	    			"{ai9me::RES}/images/cate105.png", "{ai9me::RES}/images/cate106.png",
	    			"{ai9me::RES}/images/cate107.png", "{ai9me::RES}/images/cate108.png",
	    			"{ai9me::RES}/images/cate109.png", "{ai9me::RES}/images/cate110.png",
	    			"{ai9me::RES}/images/cate111.png", "{ai9me::RES}/images/cate112.png",
	    			"{ai9me::RES}/images/cate113.png", "{ai9me::RES}/images/cate114.png",
	    			"{ai9me::RES}/images/cate5.png"];
	//加载时自动识别出当前所选择的模板索引
	onload = function(){
		var tplname = "{ai9me:$info[0].tpltypename}";
		for(var i=0; i<tplarray.length; i++)
		{
			if (tplname == tplarray[i])
			{
				document.getElementById("webmodel").selectedIndex = i;
				var tpltypename = tplarray[i];
				var srctmp = "{ai9me::U('Wap/Index/index',array('token'=>$token, 'weburl'=>$weburl, '', 'tpltypename'=>tplreplace))}";
				var src = srctmp.replace("tplreplace", tpltypename);		
				document.getElementById("webpreview").src = src;
				break;
			}
		}
		
	};
	function modelChange(selectObj)
	{
		var index = selectObj.selectedIndex;
		var tpltypename = tplarray[index];
		var srctmp = "{ai9me::U('Wap/Index/index',array('token'=>$token, 'weburl'=>$weburl, 'tpltypeid'=>tplreplace))}";
		var src = srctmp.replace("tplreplace", selectObj);		
		document.getElementById("webpreview").src = src;
		
	}
	
	function deleteImg(obj)
	{	
		var rowindex = obj.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.rowIndex;
		var table = document.getElementById("classifyTable");
		table.deleteRow(rowindex);
	}
	
	function addImg(obj)
 	{
	    if(window.XMLHttpRequest)
	    {
	      	xmlhttp=new XMLHttpRequest();
	    } else 
	    {
	      	xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
	    }
	    if (xmlhttp==null)
	    {
	    	alert ("您的浏览器不支持AJAX！");
	    	return;
	    }


	    xmlhttp.onreadystatechange=function()
	    {
	    	if (xmlhttp.readyState == 4 && xmlhttp.status == 200)
			{
	        	//设置name的值
	    		nameIndex++;
				var rowindex = obj.parentNode.parentNode.rowIndex;
				var table = document.getElementById("classifyTable");
				var newrow = table.insertRow(rowindex);
				newrow.innerHTML = xmlhttp.responseText;
				

				var names = document.getElementsByClassName("input name");
				names[names.length-1].name = "name" + nameIndex;
				var infos = document.getElementsByClassName("input info");
				infos[infos.length-1].name = "info" + nameIndex;
				var imgs = document.getElementsByClassName("input img");
				imgs[imgs.length-1].name = "img" + nameIndex;
				var imgview = document.getElementsByClassName("imgview");
				imgview[imgview.length-1].name = "img" + nameIndex + "view";
				var urls = document.getElementsByClassName("input url");
				urls[urls.length-1].name = "url" + nameIndex;
					
				var uploads = document.getElementsByClassName("upload");
				uploads[uploads.length-1].onclick = function()
				{
					var imgname = "img" + nameIndex;
					var viewname = "img" + nameIndex + "view";
					var tmpurl = "{ai9me::U('Upload/index',array('token'=>$token,'n'=>imgreplace, 'imgview'=>imgviewreplace))}";
					var url1 = tmpurl.replace("imgreplace", imgname);	
					var url = url1.replace("imgviewreplace", viewname);					
					window.open(url);
				};
			}
			
	    }
		xmlhttp.open("GET","/themes/User/default/Classify_add_innertable.html",true);
		xmlhttp.send(); 		
 	}
	

	function imgChange(imgurl, imgname)
	{
		var viewername = imgname + "view";
		var ele = document.getElementsByName(viewername);
		ele[0].src = imgurl;
		ele[0].style.display = "inline";
	}
	
	
</script>
<include file="Public:footer"/>